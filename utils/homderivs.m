function [p,pu,pv,puu,puv,pvv]=homderivs(H,p)
u=p(1, :);v=p(2, :);
h11=H(1,1);h12=H(1,2);h13=H(1,3);
h21=H(2,1);h22=H(2,2);h23=H(2,3);
h31=H(3,1);h32=H(3,2);h33=H(3,3);
x=(h11.*u+h12.*v+h13)./(h31.*u+h32.*v+h33);
xpu= h11./(h33 + h31.*u + h32.*v) - (h31.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^2;
xpv=h12./(h33 + h31.*u + h32.*v) - (h32.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^2;
xpuu=(2.*h31.^2.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^3 - (2.*h11.*h31)./(h33 + h31.*u + h32.*v).^2;
xpuv=(2.*h31.*h32.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^3 - (h12.*h31)./(h33 + h31.*u + h32.*v).^2 - (h11.*h32)./(h33 + h31.*u + h32.*v).^2;
xpvv=(2.*h32.^2.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^3 - (2.*h12.*h32)./(h33 + h31.*u + h32.*v).^2;

%xpu(h11.*h33-h31.*h13+ (h11.*h32-h31.*h12).*v)./(h31.*u+h32.*v+h33).^2;
%xpv= (h12.*h33-h32.*h13+ (h12.*h31-h32.*h11).*u)./(h31.*u+h32.*v+h33).^2;

%xpuu= (-2.*h31.*xpu)./(h31.*u+h32.*v+h33);
%xpuv= (h11.*h32-h31.*h12)./(h31.*u+h32.*v+h33).^2-(2.*xpu.*h32)./(h31.*u+h32.*v+h33);
%xpvv= (-2.*h32.*xpv)./(h31.*u+h32.*v+h33);
h11=H(2,1);h12=H(2,2);h13=H(2,3);
ypu= h11./(h33 + h31.*u + h32.*v) - (h31.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^2;
ypv=h12./(h33 + h31.*u + h32.*v) - (h32.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^2;
ypuu=(2.*h31.^2.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^3 - (2.*h11.*h31)./(h33 + h31.*u + h32.*v).^2;
ypuv=(2.*h31.*h32.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^3 - (h12.*h31)./(h33 + h31.*u + h32.*v).^2 - (h11.*h32)./(h33 + h31.*u + h32.*v).^2;
ypvv=(2.*h32.^2.*(h13 + h11.*u + h12.*v))./(h33 + h31.*u + h32.*v).^3 - (2.*h12.*h32)./(h33 + h31.*u + h32.*v).^2;

y=(h21.*u+h22.*v+h23)./(h31.*u+h32.*v+h33);
%ypu= (h21.*h33-h31.*h23+ (h21.*h32-h31.*h22).*v)./(h31.*u+h32.*v+h33).^2;
%ypv= (h22.*h33-h32.*h23+ (h22.*h31-h32.*h21).*u)./(h31.*u+h32.*v+h33).^2;
%ypuu= (-2.*h31.*ypu)./(h31.*u+h32.*v+h33);
%ypuv= (h21.*h32-h31.*h22)./(h31.*u+h32.*v+h33).^2-(2.*ypu.*h32)./(h31.*u+h32.*v+h33);

%ypvu= (h22.*h31-h32.*h21)./(h31.*u+h32.*v+h33).^2-(2.*ypv.*h31)./(h31.*u+h32.*v+h33)
%ypvv= (-2.*h32.*ypv)./(h31.*u+h32.*v+h33);
p=[x;y];
pu=[xpu;ypu];
pv=[xpv;ypv];
puu=[xpuu;ypuu];
puv=[xpuv;ypuv];
pvv=[xpvv;ypvv];
end